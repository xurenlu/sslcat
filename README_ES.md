# SSLcat - Servidor Proxy SSL

## ‚è±Ô∏è Inicio R√°pido con SSLcat en 1 Minuto

```bash
# 1) Instalaci√≥n con un clic (Linux)
# Para usuarios en China continental (acelerado via sslcat.com)
curl -fsSL https://sslcat.com/xurenlu/sslcat/main/scripts/install-from-release-zh.sh | sudo bash -s -- -v 1.0.11
# Usuarios fuera de China continental pueden usar directamente GitHub raw:
# curl -fsSL https://raw.githubusercontent.com/xurenlu/sslcat/main/scripts/install-from-release.sh | sudo bash -s -- -v 1.0.11

# 2) Prueba r√°pida local en macOS (o descargar paquete darwin manualmente)
curl -fsSL https://sslcat.com/xurenlu/sslcat/releases/download/v1.0.12/sslcat_1.0.12_darwin_arm64.tar.gz -o sslcat.tgz
tar -xzf sslcat.tgz && sudo install -m 0755 sslcat /usr/local/bin/sslcat
sslcat --config sslcat.conf --port 8080
# Acceso por navegador: http://localhost:8080/sslcat-panel/
# Primer login: admin / admin*9527 (forzar√° cambio de contrase√±a y generar√° admin.pass)

# 3) Opcional: Inicio con un clic usando Docker Compose
docker compose up -d
```

SSLcat es un potente servidor proxy SSL que soporta gesti√≥n autom√°tica de certificados, reenv√≠o de dominios, protecci√≥n de seguridad y panel de administraci√≥n web, con soporte para protocolos HTTP/3 (QUIC) y HTTP/2 (negociaci√≥n autom√°tica, compatible hacia atr√°s).

## üìö Navegaci√≥n de Documentaci√≥n

- üìë [√çndice Completo de Documentaci√≥n](DOCS.md) - √çndice y navegaci√≥n para todos los documentos
- üìñ [Resumen del Proyecto](È°πÁõÆÊÄªÁªì.md) - Introducci√≥n detallada de funciones y documentaci√≥n t√©cnica
- üöÄ [Gu√≠a de Despliegue (Chino)](DEPLOYMENT.md) - Documentaci√≥n completa de despliegue y operaciones
- üöÄ [Gu√≠a de Despliegue (Ingl√©s)](DEPLOYMENT_EN.md) - Gu√≠a de despliegue en ingl√©s

### üåç Versiones Multiidioma
- üá®üá≥ [‰∏≠Êñá README](README.md) - Versi√≥n china
- üá∫üá∏ [English README](README_EN.md) - Versi√≥n inglesa
- üáØüáµ [Êó•Êú¨Ë™û README](README_JA.md) - Versi√≥n japonesa  
- üá´üá∑ [Fran√ßais README](README_FR.md) - Versi√≥n francesa
- üá∑üá∫ [–†—É—Å—Å–∫–∏–π README](README_RU.md) - Versi√≥n rusa

## Caracter√≠sticas

### üåè Optimizaci√≥n de Red para China
- **Optimizaci√≥n de Proxy CDN**: Utiliza el servicio proxy [CDNProxy](https://cdnproxy.some.im/docs)
- **Aceleraci√≥n de Acceso**: Resuelve problemas de acceso a jsdelivr CDN en China continental
- **Estabilidad**: Asegura carga estable de recursos a trav√©s del servicio proxy

### üîí Gesti√≥n Autom√°tica de Certificados SSL
- Obtenci√≥n autom√°tica de certificados SSL de Let's Encrypt
- Soporte para renovaci√≥n autom√°tica de certificados
- Soporte para entornos de staging y producci√≥n
- Cach√© de certificados y optimizaci√≥n de rendimiento
- **Operaciones de Certificados en Lote**: Descarga/importaci√≥n de todos los certificados con un clic (formato ZIP)

### üîÑ Reenv√≠o Inteligente de Dominios
- Reenv√≠o de proxy inteligente basado en nombres de dominio
- Soporte para protocolos HTTP/HTTPS
- Soporte para proxy WebSocket
- Pool de conexiones y balanceador de carga

### üõ°Ô∏è Mecanismos de Protecci√≥n de Seguridad
- Bloqueo de IP y control de acceso
- Protecci√≥n anti-fuerza bruta
- Validaci√≥n de User-Agent
- Registro de accesos
- **Fingerprinting de Cliente TLS**: Identificaci√≥n de cliente basada en caracter√≠sticas ClientHello
- **Optimizaci√≥n para Entorno de Producci√≥n**: Umbrales de seguridad m√°s tolerantes para escenarios de alto tr√°fico

### üéõÔ∏è Panel de Administraci√≥n Web
- Interfaz web intuitiva
- Monitoreo y estad√≠sticas en tiempo real
- Gesti√≥n de reglas de proxy
- Gesti√≥n de certificados SSL
- Configuraci√≥n de seguridad
- **Gesti√≥n de Tokens API**: Control de acceso API de solo lectura/lectura-escritura
- **Estad√≠sticas de Huellas TLS**: Datos de an√°lisis de huellas de cliente en tiempo real

### üîÑ Reinicio Elegante
- Reinicio sin tiempo de inactividad
- Preservaci√≥n de conexiones y recuperaci√≥n de estado
- Mecanismo de apagado elegante

## Requisitos del Sistema

- Sistema Linux (Ubuntu/Debian/CentOS/RHEL)
- Go 1.21 o superior
- Privilegios root
- Puertos 80 y 443 disponibles

## üì• Obtener C√≥digo Fuente

### Repositorio GitHub

Proyecto alojado en GitHub: **[https://github.com/xurenlu/sslcat](https://github.com/xurenlu/sslcat)**

### Descarga de √öltima Versi√≥n

```bash
# Clonar c√≥digo fuente m√°s reciente
git clone https://github.com/xurenlu/sslcat.git
cd sslcat

# O descargar versi√≥n espec√≠fica (recomendado)
wget https://github.com/xurenlu/sslcat/archive/refs/heads/main.zip
unzip main.zip
cd sslcat-main
```

## üöÄ Instalaci√≥n R√°pida

### Instalaci√≥n Autom√°tica (Recomendado)

```bash
# Descargar script de instalaci√≥n desde GitHub
curl -fsSL https://raw.githubusercontent.com/xurenlu/sslcat/main/install.sh -o install.sh

# Ejecutar script de instalaci√≥n
sudo bash install.sh
```

### Despliegue Embebido (Archivo √önico)

```bash
# Generar paquete de despliegue embebido
./deploy-embedded.sh

# O generar versi√≥n Linux
./deploy-embedded.sh linux

# Luego subir directorio deploy/ al servidor
```

### Instalaci√≥n Manual

1. **Instalar Dependencias**
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y curl wget git build-essential ca-certificates certbot

# CentOS/RHEL
sudo yum update -y
sudo yum install -y curl wget git gcc gcc-c++ make ca-certificates certbot
```

2. **Instalar Go**
```bash
# Descargar e instalar Go 1.21
wget https://go.dev/dl/go1.21.5.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.21.5.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc
```

3. **Compilar SSLcat**
```bash
git clone https://github.com/xurenlu/sslcat.git
cd sslcat
go mod download
go build -o sslcat main.go
```

4. **Crear Usuario y Directorios**
```bash
sudo useradd -r -s /bin/false sslcat
sudo mkdir -p /etc/sslcat /var/lib/sslcat/{certs,keys,logs}
sudo chown -R sslcat:sslcat /var/lib/sslcat
```

5. **Configurar e Iniciar**
```bash
sudo cp sslcat /opt/sslcat/
sudo cp sslcat.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable sslcat
sudo systemctl start sslcat
```

## Configuraci√≥n

### Ubicaci√≥n del Archivo de Configuraci√≥n
- Archivo de configuraci√≥n principal: `/etc/sslcat/sslcat.conf`
- Directorio de certificados: `/var/lib/sslcat/certs`
- Directorio de claves: `/var/lib/sslcat/keys`
- Directorio de logs: `/var/lib/sslcat/logs`

### Configuraci√≥n B√°sica

```yaml
server:
  host: "0.0.0.0"
  port: 443
  debug: false

ssl:
  email: "your-email@example.com"  # Email para certificado SSL
  staging: false                   # Si usar entorno de staging
  auto_renew: true                 # Renovaci√≥n autom√°tica

admin:
  username: "admin"
  password_file: "/var/lib/sslcat/admin.pass"     # Contrase√±a guardada en este archivo, sslcat.conf no persiste password
  first_run: true

proxy:
  rules:
    - domain: "example.com"
      target: "127.0.0.1"
      port: 8080
      enabled: true
      ssl_only: true

security:
  max_attempts: 3                  # M√°x. intentos fallidos en 1 minuto
  block_duration: "1m"             # Duraci√≥n del bloqueo
  max_attempts_5min: 10            # M√°x. intentos fallidos en 5 minutos

admin_prefix: "/sslcat-panel"     # Prefijo de ruta del panel de administraci√≥n
```

### Recuperaci√≥n de Contrase√±a (Recuperaci√≥n de Emergencia)

SSLcat usa la estrategia de seguridad "archivo marcador + cambio forzado de contrase√±a en primer uso":

- Archivo marcador: `admin.password_file` (por defecto `./data/admin.pass`). El archivo guarda la contrase√±a actual del admin con permisos 0600.
- Primer login: Si el archivo marcador no existe, o el contenido del archivo sigue siendo la contrase√±a por defecto `admin*9527`, el admin ser√° forzado a la p√°gina "cambiar contrase√±a" despu√©s del login exitoso para establecer nueva contrase√±a y escribir al archivo marcador.

Pasos de recuperaci√≥n de contrase√±a:

1. Detener servicio (o mantener ejecut√°ndose, se recomienda detener).
2. Eliminar archivo marcador (si la ruta cambi√≥, eliminar seg√∫n la ruta real de configuraci√≥n):
   ```bash
   rm -f ./data/admin.pass
   ```
3. Reiniciar servicio, login con cuenta por defecto (admin / admin*9527).
4. El sistema forzar√° entrar a la p√°gina "cambiar contrase√±a", establecer nueva contrase√±a para restaurar operaci√≥n normal.

Nota: Por razones de seguridad, `sslcat.conf` ya no persiste `admin.password` en texto plano al guardar; en tiempo de ejecuci√≥n la contrase√±a real usa `admin.password_file` como est√°ndar.

## Uso

### Iniciar Servicio
```bash
sudo systemctl start sslcat
```

### Detener Servicio
```bash
sudo systemctl stop sslcat
```

### Reiniciar Servicio
```bash
sudo systemctl restart sslcat
```

### Reinicio Elegante
```bash
sudo systemctl reload sslcat
# o enviar se√±al SIGHUP
sudo kill -HUP $(pgrep sslcat)
```

### Ver Logs
```bash
# Ver estado del servicio
sudo systemctl status sslcat

# Ver logs en tiempo real
sudo journalctl -u sslcat -f

# Ver logs de error
sudo journalctl -u sslcat -p err
```

## Panel de Administraci√≥n Web

### Acceder al Panel de Administraci√≥n

**‚ö†Ô∏è Importante: M√©todo de Acceso Inicial**

Como el sistema no tiene certificados SSL cuando se instala por primera vez, por favor usa el siguiente m√©todo para el acceso inicial:

1. **Primer Acceso** (usando direcci√≥n IP del servidor):
   ```
   http://YOUR_SERVER_IP/sslcat-panel
   ```
   Nota: Usa `http://` (no https) porque a√∫n no hay certificados SSL

2. **Despu√©s de configurar dominio y obtener certificados**:
   ```
   https://your-domain/your-custom-panel-path
   ```

**Proceso de Login:**
1. Login con credenciales por defecto:
   - Nombre de usuario: `admin`
   - Contrase√±a: `admin*9527`
2. El primer login forzar√°:
   - Cambiar contrase√±a del administrador
   - Personalizar ruta de acceso del panel (por seguridad)
3. **¬°Por favor recuerda la nueva ruta del panel!** El sistema redirigir√° autom√°ticamente a la nueva ruta

### Funciones del Panel de Administraci√≥n
- **Dashboard**: Ver estado del sistema y estad√≠sticas
- **Configuraci√≥n de Proxy**: Gestionar reglas de reenv√≠o de dominios
- **Certificados SSL**: Ver y gestionar certificados SSL
- **Configuraciones de Seguridad**: Configurar pol√≠ticas de seguridad y ver IPs bloqueadas
- **Configuraciones del Sistema**: Modificar configuraci√≥n del sistema

## Configuraci√≥n de Proxy

### Agregar Regla de Proxy
1. Login al panel de administraci√≥n
2. Ir a la p√°gina "Configuraci√≥n de Proxy"
3. Hacer clic en "Nueva Regla de Proxy"
4. Llenar configuraci√≥n:
   - Dominio: Dominio a proxificar
   - Objetivo: IP o dominio del servidor backend
   - Puerto: Puerto del servicio backend
   - Habilitado: Si habilitar esta regla
   - Solo SSL: Si permitir solo acceso HTTPS

### Ejemplo de Regla de Proxy
```yaml
proxy:
  rules:
    - domain: "api.example.com"
      target: "127.0.0.1"
      port: 3000
      enabled: true
      ssl_only: true
    - domain: "app.example.com"
      target: "192.168.1.100"
      port: 8080
      enabled: true
      ssl_only: false
```

## Gesti√≥n de Certificados SSL

### Adquisici√≥n Autom√°tica de Certificados
SSLcat obtiene autom√°ticamente certificados SSL para dominios configurados sin intervenci√≥n manual.

### Renovaci√≥n de Certificados
Los certificados se renuevan autom√°ticamente 30 d√≠as antes del vencimiento, o pueden ser activados manualmente.

### Almacenamiento de Certificados
- Archivo de certificado: `/var/lib/sslcat/certs/domain.crt`
- Archivo de clave privada: `/var/lib/sslcat/keys/domain.key`

## Funciones de Seguridad

### Mecanismo de Bloqueo de IP
- Bloqueo autom√°tico despu√©s de 3 intentos fallidos en 1 minuto
- Bloqueo autom√°tico despu√©s de 10 intentos fallidos en 5 minutos
- Duraci√≥n de bloqueo configurable
- Soporte para desbloqueo manual

### Control de Acceso
- Validaci√≥n de User-Agent
- Rechazar acceso con User-Agent vac√≠o
- Rechazar acceso con User-Agent de navegadores poco comunes

### Desbloquear IPs
```bash
# Eliminar archivo de bloqueo y reiniciar servicio
sudo rm /var/lib/sslcat/sslcat.block
sudo systemctl restart sslcat
```

## Argumentos de L√≠nea de Comandos

```bash
sslcat [opciones]

Opciones:
  --config string        Ruta del archivo de configuraci√≥n (por defecto: "/etc/sslcat/sslcat.conf")
  --admin-prefix string  Prefijo de ruta del panel de administraci√≥n (por defecto: "/sslcat-panel")
  --email string         Email para certificado SSL
  --staging             Usar entorno de staging de Let's Encrypt
  --port int            Puerto de escucha (por defecto: 443)
  --host string         Direcci√≥n de escucha (por defecto: "0.0.0.0")
  --log-level string    Nivel de log (por defecto: "info")
  --version             Mostrar informaci√≥n de versi√≥n
```

## Soluci√≥n de Problemas

### Problemas Comunes

1. **Falla al iniciar servicio**
   ```bash
   # Verificar sintaxis del archivo de configuraci√≥n
   sudo withssl --config /etc/sslcat/withssl.conf --log-level debug
   
   # Verificar uso de puerto
   sudo netstat -tlnp | grep :443
   ```

2. **Falla en adquisici√≥n de certificado SSL**
   - Asegurar que la resoluci√≥n del dominio sea correcta
   - Asegurar que el puerto 80 sea accesible
   - Verificar configuraciones del firewall
   - Usar entorno de staging para pruebas

3. **Falla en reenv√≠o de proxy**
   - Verificar si el servidor objetivo es alcanzable
   - Verificar que el puerto sea correcto
   - Revisar logs de acceso

4. **Panel de administraci√≥n inaccesible**
   - Verificar configuraciones del firewall
   - Verificar que el certificado SSL sea v√°lido
   - Revisar logs del servicio

### An√°lisis de Logs
```bash
# Ver logs detallados
sudo journalctl -u sslcat -f --no-pager

# Filtrar logs de error
sudo journalctl -u sslcat -p err --since "1 hour ago"

# Ver logs de per√≠odo espec√≠fico
sudo journalctl -u sslcat --since "2024-01-01 00:00:00" --until "2024-01-01 23:59:59"
```

## Optimizaci√≥n de Rendimiento

### Optimizaci√≥n del Sistema
```bash
# Aumentar l√≠mite de descriptores de archivo
echo "* soft nofile 65536" >> /etc/security/limits.conf
echo "* hard nofile 65536" >> /etc/security/limits.conf

# Optimizar par√°metros de red
echo "net.core.somaxconn = 65536" >> /etc/sysctl.conf
echo "net.ipv4.tcp_max_syn_backlog = 65536" >> /etc/sysctl.conf
sysctl -p
```

### Optimizaci√≥n de Configuraci√≥n
```yaml
server:
  # Habilitar modo debug para an√°lisis de rendimiento
  debug: false
  
proxy:
  # Configurar n√∫mero razonable de reglas de proxy
  rules: []
  
security:
  # Ajustar par√°metros de seguridad
  max_attempts: 5
  block_duration: "5m"
```

## Optimizaci√≥n de Red

### Optimizaci√≥n para Usuarios de China Continental

SSLcat ha sido optimizado para el entorno de red de China continental, usando el servicio proxy [CDNProxy](https://cdnproxy.some.im/docs) para resolver problemas de acceso a jsdelivr CDN.

#### Uso de Proxy CDN
- **Direcci√≥n original**: `https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css`
- **Direcci√≥n proxy**: `https://cdnproxy.some.im/cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css`

#### Archivos de Recursos Involucrados
- Bootstrap 5.1.3 CSS
- Bootstrap Icons 1.7.2
- Bootstrap 5.1.3 JavaScript
- Biblioteca Axios JavaScript

#### Control de Acceso
Seg√∫n la documentaci√≥n de CDNProxy, el servicio implementa pol√≠ticas de control de acceso. Si el acceso es bloqueado, usualmente es porque el dominio Referer de la petici√≥n no est√° en la lista blanca. Contactar al administrador del servicio para agregar su dominio a la lista blanca si es necesario.

## Gu√≠a de Desarrollo

### Estructura del Proyecto
```
sslcat/
‚îú‚îÄ‚îÄ main.go                 # Entrada principal del programa
‚îú‚îÄ‚îÄ go.mod                  # Archivo de m√≥dulo Go
‚îú‚îÄ‚îÄ internal/               # Paquetes internos
‚îÇ   ‚îú‚îÄ‚îÄ config/            # Gesti√≥n de configuraci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ logger/            # Gesti√≥n de logs
‚îÇ   ‚îú‚îÄ‚îÄ ssl/               # Gesti√≥n de certificados SSL
‚îÇ   ‚îú‚îÄ‚îÄ proxy/             # Gesti√≥n de proxy
‚îÇ   ‚îú‚îÄ‚îÄ security/          # Gesti√≥n de seguridad
‚îÇ   ‚îú‚îÄ‚îÄ web/               # Servidor web
‚îÇ   ‚îî‚îÄ‚îÄ graceful/          # Reinicio elegante
‚îú‚îÄ‚îÄ web/                   # Recursos web
‚îÇ   ‚îú‚îÄ‚îÄ templates/         # Plantillas HTML
‚îÇ   ‚îî‚îÄ‚îÄ static/            # Recursos est√°ticos
‚îú‚îÄ‚îÄ install.sh             # Script de instalaci√≥n
‚îî‚îÄ‚îÄ README.md              # Documentaci√≥n
```

### Configuraci√≥n del Entorno de Desarrollo
```bash
# Clonar proyecto
git clone https://github.com/xurenlu/sslcat.git
cd sslcat

# Instalar dependencias
go mod download

# Ejecutar servidor de desarrollo
go run main.go --config sslcat.conf --log-level debug
```

### Gu√≠a de Contribuci√≥n
1. Fork del proyecto
2. Crear rama de funcionalidad
3. Confirmar cambios
4. Push a la rama
5. Crear Pull Request

## Licencia

Este proyecto usa la licencia MIT. Ver archivo [LICENSE](LICENSE) para detalles.

## Soporte

Si encuentras problemas o tienes sugerencias:
1. Revisar la secci√≥n [Soluci√≥n de Problemas](#soluci√≥n-de-problemas)
2. Buscar en [Issues](https://github.com/xurenlu/sslcat/issues)
3. Crear un nuevo Issue
4. Contactar a los mantenedores

## Registro de Cambios

Para el historial completo de actualizaciones de versi√≥n, consulte: **[CHANGELOG.md](CHANGELOG.md)**

### √öltima Versi√≥n v1.1.0 (2025-09-08)
- Tiempos de espera configurables del servidor: `read_timeout_sec`, `write_timeout_sec`, `idle_timeout_sec` (por defecto: 30min lectura/escritura, 120s inactivo)
- Carga mejorada: `max_upload_bytes` (por defecto 1 GiB); cargas individuales y ZIP por streaming con l√≠mite total para evitar uso de memoria
- Consistencia UI: orden unificado de la barra lateral; a√±adido "Idioma" y "Sitio Oficial" en Dashboard/Sitios Est√°ticos/Sitios PHP; corregidos iconos faltantes
- Inicio de sesi√≥n y seguridad: captcha temporalmente deshabilitado (reversible)
- Documentaci√≥n e i18n: READMEs multilenguaje actualizados; hoja de ruta actualizada

### √öltima Versi√≥n v1.0.15 (2025-01-03)
- üåê Arquitectura de cl√∫ster Master-Slave: Soporte para despliegue multi-nodo con alta disponibilidad
- üîÑ Sincronizaci√≥n autom√°tica de configuraci√≥n: Env√≠o en tiempo real desde Master a todos los nodos Slave
- üîí Control de separaci√≥n de permisos: Restricciones funcionales estrictas en modo Slave
- üñ•Ô∏è Interfaz de gesti√≥n de cl√∫ster: Monitoreo completo del estado de nodos y gesti√≥n
- üìä Informaci√≥n de monitoreo detallada: Direcci√≥n IP, puerto, recuento de certificados, MD5 de configuraci√≥n, y m√°s